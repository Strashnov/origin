unit dm—omponents;

interface

uses
  System.SysUtils, System.Classes, FMX.StdActns, System.Actions, FMX.ActnList,
  System.ImageList, FMX.ImgList, FMX.Types, FMX.Controls, IdBaseComponent,
  IdComponent, IdCustomTCPServer, IdTCPServer, FMX.Forms, IdServerIOHandler,
  IdServerIOHandlerSocket, IdServerIOHandlerStack, IdIntercept,
  IdCompressionIntercept, IdContext, libChangeStyle, FireDAC.Stan.Intf,
  FireDAC.Stan.Option, FireDAC.Stan.Error, FireDAC.UI.Intf, FireDAC.Phys.Intf,
  FireDAC.Stan.Def, FireDAC.Stan.Pool, FireDAC.Stan.Async, FireDAC.Phys,
  FireDAC.FMXUI.Wait, FireDAC.Stan.Param, FireDAC.DatS, FireDAC.DApt.Intf,
  FireDAC.DApt, Data.DB, FireDAC.Comp.DataSet, FireDAC.Comp.Client,
  FireDAC.Phys.IB, FireDAC.Phys.IBDef, FireDAC.VCLUI.Wait;

type
  TdmCompanents = class(TDataModule)
    ImageList: TImageList;
    sbLight: TStyleBook; // Light theme
    sbDark: TStyleBook; // Dark theme
    IdTCPServer: TIdTCPServer;
    Language: TLang;
    IdServerCompressionIntercept: TIdServerCompressionIntercept;
    IdServerIOHandlerStack: TIdServerIOHandlerStack;
    FDConnection: TFDConnection;
    FDTransaction: TFDTransaction;
    FDQuery: TFDQuery;
    FDQueryID: TIntegerField;
    FDQueryNAME: TStringField;
    FDQueryEMAIL: TStringField;
    FDQueryTEL: TIntegerField;
    procedure ChangeStyleLight; // Light theme
    procedure ChangeStyleDark; // Dark theme
    procedure IdTCPServerExecute(AContext: TIdContext);
  private
    { Private declarations }
  public
    { Public declarations }
    MyStream: TMemoryStream;
  end;

var
  dmCompanents: TdmCompanents;

implementation

{%CLASSGROUP 'FMX.Controls.TControl'}

uses mainServer;

{$R *.dfm}
{ TdmCompanents }

procedure TdmCompanents.ChangeStyleDark; // Dark theme
var
  ChangeStyle: TChangeStyle; // Library loading from libChangeStyle.pas
begin
  ChangeStyle := TChangeStyle.Create;
  try
    ChangeStyle.ChangeStyle(sbDark);
  finally
    ChangeStyle.Free;
  end;
end;

procedure TdmCompanents.ChangeStyleLight; // Light theme
var
  ChangeStyle: TChangeStyle; // Library loading from libChangeStyle.pas
begin
  ChangeStyle := TChangeStyle.Create;
  try
    ChangeStyle.ChangeStyle(sbLight);
  finally
    ChangeStyle.Free;
  end;
end;

procedure TdmCompanents.IdTCPServerExecute(AContext: TIdContext);
// Accept data from the client
var
  s: string;
begin
  MyStream := TMemoryStream.Create;
  try;

    AContext.Connection.Socket.ReadStream(MyStream, 0, True);

    //formMain.memMessageFromClient.Lines.Add(s);
    formMain.memMessageFromClient.Lines.LoadFromStream(MyStream);

    AContext.Connection.IOHandler.ReadStream(MyStream, 0, True);
    //FDQuery.Open();
    //FDQuery.Insert;
    AContext.Connection.Socket.WriteLn('Response from server...');
  finally
    AContext.Connection.Disconnect;
  end;

end;

end.
